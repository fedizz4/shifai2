{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/MacBook Air/Desktop/shifai1VV/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { MedicamentFormComponent } from './medicament-form/medicament-form.component';\nimport { inscritUid } from 'src/app/login/login.page';\nimport { ModifComponent } from './modif/modif.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/firestore\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"src/app/event.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/router\";\nconst _c0 = [\"myModal\"];\nfunction MedicamentPage_ng_container_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainer(0);\n  }\n}\nfunction MedicamentPage_tr_39_ng_container_6_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const prise_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", prise_r5.label, \" \");\n  }\n}\nfunction MedicamentPage_tr_39_ng_container_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, MedicamentPage_tr_39_ng_container_6_ng_container_1_Template, 2, 1, \"ng-container\", 12);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const prise_r5 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", prise_r5.checked);\n  }\n}\nfunction MedicamentPage_tr_39_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtemplate(6, MedicamentPage_tr_39_ng_container_6_Template, 2, 1, \"ng-container\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\")(8, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function MedicamentPage_tr_39_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const medicament_r3 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.openModifModal(medicament_r3));\n    });\n    i0.ɵɵtext(9, \"Modifier/supprimer\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const medicament_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(medicament_r3.nom);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(medicament_r3.dosage);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", medicament_r3.prises);\n  }\n}\nexport let MedicamentPage = /*#__PURE__*/(() => {\n  var _MedicamentPage;\n  class MedicamentPage {\n    constructor(firestore, modalController, eventService) {\n      this.firestore = firestore;\n      this.modalController = modalController;\n      this.eventService = eventService;\n      this.medicamentFormComponent = MedicamentFormComponent;\n      this.uid = inscritUid;\n      this.medicaments = [];\n      // Souscrire à l'événement de mise à jour des médicaments\n      this.subscription = this.eventService.medicamentUpdated.subscribe(() => {\n        this.fetchMedicaments();\n      });\n    }\n    openMedicamentFormModal() {\n      this.modalController.create({\n        component: this.medicamentFormComponent\n      }).then(modal => {\n        modal.present();\n      });\n    }\n    openModifModal(med) {\n      this.modalController.create({\n        component: ModifComponent,\n        componentProps: {\n          med: med\n        }\n      }).then(modal => {\n        modal.present();\n      });\n    }\n    dismissModal() {\n      this.modalController.dismiss();\n    }\n    ionViewDidEnter() {\n      // Appeler fetchMedicaments lors de l'entrée dans la vue\n      this.fetchMedicaments();\n    }\n    // Utilisez la fonction pour récupérer les médicaments d'un utilisateur\n    fetchMedicaments() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          // Effectuer une requête Firestore avec la clause where directement sur la collection\n          const querySnapshot = yield _this.firestore.firestore.collection('medicaments').where('uid', '==', _this.uid).get();\n          // Réinitialiser le tableau des médicaments avant de le remplir à nouveau\n          _this.medicaments = [];\n          // Itérer sur chaque document de la collection\n          querySnapshot.forEach(doc => {\n            // Accéder à l'ID du document via doc.id\n            const idd = doc.id;\n            // Accéder aux données du document via doc.data()\n            const data = doc.data(); // Assurez-vous de caster les données correctement\n            // Ajouter l'ID au champ idd dans les données du médicament\n            data.idd = idd;\n            console.log(idd);\n            // Ajouter le médicament au tableau des médicaments\n            _this.medicaments.push(data);\n          });\n          console.log('Médicaments de l\\'utilisateur :', _this.medicaments);\n        } catch (error) {\n          console.error('Erreur lors de la récupération des médicaments :', error);\n        }\n      })();\n    }\n    ngOnDestroy() {\n      // Assurez-vous de désabonner la souscription pour éviter les fuites de mémoire\n      this.subscription.unsubscribe();\n    }\n    getIconName(prises, label) {\n      const prise = prises.find(p => p.label === label);\n      return prise ? prise.checked ? 'checkmark' : 'close' : '';\n    }\n  }\n  _MedicamentPage = MedicamentPage;\n  _MedicamentPage.ɵfac = function MedicamentPage_Factory(t) {\n    return new (t || _MedicamentPage)(i0.ɵɵdirectiveInject(i1.AngularFirestore), i0.ɵɵdirectiveInject(i2.ModalController), i0.ɵɵdirectiveInject(i3.EventService));\n  };\n  _MedicamentPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _MedicamentPage,\n    selectors: [[\"app-medicament\"]],\n    viewQuery: function MedicamentPage_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.myModal = _t.first);\n      }\n    },\n    decls: 40,\n    vars: 4,\n    consts: [[3, \"translucent\"], [\"slot\", \"start\"], [\"routerLink\", \"/tabs/tab1\"], [3, \"fullscreen\"], [\"collapse\", \"condense\"], [\"size\", \"large\"], [1, \"right\", 3, \"click\"], [\"myModal\", \"\"], [3, \"click\"], [4, \"ngComponentOutlet\"], [1, \"table\", \"table-lg\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"]],\n    template: function MedicamentPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-buttons\", 1)(3, \"ion-button\", 2);\n        i0.ɵɵtext(4, \"Retour\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"ion-title\");\n        i0.ɵɵtext(6, \"Mes M\\u00E9dicaments\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(7, \"ion-content\", 3)(8, \"ion-header\", 4)(9, \"ion-toolbar\")(10, \"ion-title\", 5);\n        i0.ɵɵtext(11, \"medicament\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(12, \"h1\");\n        i0.ɵɵtext(13, \"Liste de M\\u00E9dicaments\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"ion-button\", 6);\n        i0.ɵɵlistener(\"click\", function MedicamentPage_Template_ion_button_click_14_listener() {\n          return ctx.openMedicamentFormModal();\n        });\n        i0.ɵɵtext(15, \"Ajouter un m\\u00E9dicament\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"ion-modal\", null, 7)(18, \"ion-header\")(19, \"ion-toolbar\")(20, \"ion-buttons\", 1)(21, \"ion-button\", 8);\n        i0.ɵɵlistener(\"click\", function MedicamentPage_Template_ion_button_click_21_listener() {\n          return ctx.dismissModal();\n        });\n        i0.ɵɵtext(22, \"Cancel\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(23, \"ion-title\");\n        i0.ɵɵtext(24, \"Ajouter un M\\u00E9dicament\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(25, \"ion-content\");\n        i0.ɵɵtemplate(26, MedicamentPage_ng_container_26_Template, 1, 0, \"ng-container\", 9);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(27, \"table\", 10)(28, \"thead\")(29, \"tr\")(30, \"th\");\n        i0.ɵɵtext(31, \"Nom\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"th\");\n        i0.ɵɵtext(33, \"Dosage\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(34, \"th\");\n        i0.ɵɵtext(35, \"Prises\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"th\");\n        i0.ɵɵtext(37, \"Actions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(38, \"tbody\");\n        i0.ɵɵtemplate(39, MedicamentPage_tr_39_Template, 10, 3, \"tr\", 11);\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"translucent\", true);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"fullscreen\", true);\n        i0.ɵɵadvance(19);\n        i0.ɵɵproperty(\"ngComponentOutlet\", ctx.medicamentFormComponent);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.medicaments);\n      }\n    },\n    dependencies: [i4.NgComponentOutlet, i4.NgForOf, i4.NgIf, i2.IonButton, i2.IonButtons, i2.IonContent, i2.IonHeader, i2.IonTitle, i2.IonToolbar, i2.IonModal, i2.RouterLinkDelegate, i5.RouterLink],\n    styles: [\"@charset \\\"UTF-8\\\";.table-lg[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:18px;padding:20px}\"]\n  });\n  return MedicamentPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}